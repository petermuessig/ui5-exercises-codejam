sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,r){"use strict";return e.extend("sap.codejam.controller.App",{onInit:function(){this.getView().setModel(new t({itemSelected:false,selectedQuantity:1}),"userSelection")},onSelect:function(e){let t=this.getView().getModel("userSelection");let o=e.getSource().getBindingContext().sPath;let r=e.getSource().getModel().getProperty(o);t.setProperty("/selectedItemPath",o);t.setProperty("/selectedItemData",r);t.setProperty("/selectedQuantity",1);this.getView().byId("orderStatus").setText("");t.setProperty("/itemSelected",true)},onSubmitOrder:function(){let e=this.getView();let t=e.getModel("userSelection").getData();let o={url:"/browse/submitOrder",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({book:t.selectedItemData.ID,quantity:t.selectedQuantity})};let r=e.getModel("i18n");jQuery.ajax(o).done(function(o){console.log(o);e.byId("orderStatus").setText(`${r.getProperty("orderSuccessful")} \n                            (${t.selectedItemData.title}, \n                            ${t.selectedQuantity} \n                            ${r.getProperty("pieces")})`);e.byId("orderStatus").setState("Success");let s=e.getModel("userSelection").getProperty("/selectedItemPath");e.getModel().setProperty(s+"/stock",o.stock);e.getModel("userSelection").setProperty("/selectedItemData/stock",o.stock)}).fail(function(t){console.log(t);e.byId("orderStatus").setText(`${r.getProperty("Error")}`);e.byId("orderStatus").setState("Error")})},onSearch:function(e){var t=[];var s=e.getParameter("newValue");if(s){t.push(new o("title",r.Contains,s))}var l=this.byId("booksTable");var i=l.getBinding("items");i.filter(t);let n=this.getView().getModel("userSelection");n.setProperty("/selectedItemPath",{});n.setProperty("/selectedItemData",{});this.getView().byId("orderStatus").setText("");n.setProperty("/itemSelected",false)}})});